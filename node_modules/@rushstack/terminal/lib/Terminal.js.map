{"version":3,"file":"Terminal.js","sourceRoot":"","sources":["../src/Terminal.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n// See LICENSE in the project root for license information.\n\nimport { type ITerminalProvider, TerminalProviderSeverity } from './ITerminalProvider';\nimport { Colorize } from './Colorize';\nimport type { ITerminal, ITerminalWriteOptions, TerminalWriteParameters } from './ITerminal';\nimport { AnsiEscape } from './AnsiEscape';\n\n/**\n * This class facilitates writing to a console.\n *\n * @beta\n */\nexport class Terminal implements ITerminal {\n  private readonly _providers: Set<ITerminalProvider>;\n\n  public constructor(provider: ITerminalProvider) {\n    this._providers = new Set<ITerminalProvider>([provider]);\n  }\n\n  /**\n   * {@inheritdoc ITerminal.registerProvider}\n   */\n  public registerProvider(provider: ITerminalProvider): void {\n    this._providers.add(provider);\n  }\n\n  /**\n   * {@inheritdoc ITerminal.unregisterProvider}\n   */\n  public unregisterProvider(provider: ITerminalProvider): void {\n    this._providers.delete(provider);\n  }\n\n  /**\n   * {@inheritdoc ITerminal.write}\n   */\n  public write(...messageParts: TerminalWriteParameters): void {\n    const { parts } = this._normalizeWriteParameters(messageParts);\n    this._writeSegmentsToProviders(parts, TerminalProviderSeverity.log, false);\n  }\n\n  /**\n   * {@inheritdoc ITerminal.writeLine}\n   */\n  public writeLine(...messageParts: TerminalWriteParameters): void {\n    const { parts } = this._normalizeWriteParameters(messageParts);\n    this._writeSegmentsToProviders(parts, TerminalProviderSeverity.log, true);\n  }\n\n  /**\n   * {@inheritdoc ITerminal.writeWarning}\n   */\n  public writeWarning(...messageParts: TerminalWriteParameters): void {\n    const {\n      parts,\n      options: { doNotOverrideSgrCodes }\n    } = this._normalizeWriteParameters(messageParts);\n    this._writeSegmentsToProviders(\n      doNotOverrideSgrCodes\n        ? parts\n        : parts.map((part): string => Colorize.yellow(AnsiEscape.removeCodes(part))),\n      TerminalProviderSeverity.warning,\n      false\n    );\n  }\n\n  /**\n   * {@inheritdoc ITerminal.writeWarningLine}\n   */\n  public writeWarningLine(...messageParts: TerminalWriteParameters): void {\n    const {\n      parts,\n      options: { doNotOverrideSgrCodes }\n    } = this._normalizeWriteParameters(messageParts);\n    this._writeSegmentsToProviders(\n      doNotOverrideSgrCodes\n        ? parts\n        : parts.map((part): string => Colorize.yellow(AnsiEscape.removeCodes(part))),\n      TerminalProviderSeverity.warning,\n      true\n    );\n  }\n\n  /**\n   * {@inheritdoc ITerminal.writeError}\n   */\n  public writeError(...messageParts: TerminalWriteParameters): void {\n    const {\n      parts,\n      options: { doNotOverrideSgrCodes }\n    } = this._normalizeWriteParameters(messageParts);\n    this._writeSegmentsToProviders(\n      doNotOverrideSgrCodes ? parts : parts.map((part): string => Colorize.red(AnsiEscape.removeCodes(part))),\n      TerminalProviderSeverity.error,\n      false\n    );\n  }\n\n  /**\n   * {@inheritdoc ITerminal.writeErrorLine}\n   */\n  public writeErrorLine(...messageParts: TerminalWriteParameters): void {\n    const {\n      parts,\n      options: { doNotOverrideSgrCodes }\n    } = this._normalizeWriteParameters(messageParts);\n    this._writeSegmentsToProviders(\n      doNotOverrideSgrCodes ? parts : parts.map((part): string => Colorize.red(AnsiEscape.removeCodes(part))),\n      TerminalProviderSeverity.error,\n      true\n    );\n  }\n\n  /**\n   * {@inheritdoc ITerminal.writeVerbose}\n   */\n  public writeVerbose(...messageParts: TerminalWriteParameters): void {\n    const { parts } = this._normalizeWriteParameters(messageParts);\n    this._writeSegmentsToProviders(parts, TerminalProviderSeverity.verbose, false);\n  }\n\n  /**\n   * {@inheritdoc ITerminal.writeVerboseLine}\n   */\n  public writeVerboseLine(...messageParts: TerminalWriteParameters): void {\n    const { parts } = this._normalizeWriteParameters(messageParts);\n    this._writeSegmentsToProviders(parts, TerminalProviderSeverity.verbose, true);\n  }\n\n  /**\n   * {@inheritdoc ITerminal.writeDebug}\n   */\n  public writeDebug(...messageParts: TerminalWriteParameters): void {\n    const { parts } = this._normalizeWriteParameters(messageParts);\n    this._writeSegmentsToProviders(parts, TerminalProviderSeverity.debug, false);\n  }\n\n  /**\n   * {@inheritdoc ITerminal.writeDebugLine}\n   */\n  public writeDebugLine(...messageParts: TerminalWriteParameters): void {\n    const { parts } = this._normalizeWriteParameters(messageParts);\n    this._writeSegmentsToProviders(parts, TerminalProviderSeverity.debug, true);\n  }\n\n  private _writeSegmentsToProviders(\n    segments: string[],\n    severity: TerminalProviderSeverity,\n    followedByEol: boolean\n  ): void {\n    const lines: string[] = [segments.join('')];\n    if (followedByEol) {\n      lines.push('');\n    }\n\n    let linesWithoutColor: string[] | undefined;\n\n    const concatenatedLinesWithColorByNewlineChar: Map<string, string> = new Map();\n    const concatenatedLinesWithoutColorByNewlineChar: Map<string, string> = new Map();\n    for (const provider of this._providers) {\n      let textToWrite: string | undefined;\n      const eol: string = provider.eolCharacter;\n      if (provider.supportsColor) {\n        textToWrite = concatenatedLinesWithColorByNewlineChar.get(eol);\n        if (!textToWrite) {\n          textToWrite = lines.join(eol);\n          concatenatedLinesWithColorByNewlineChar.set(eol, textToWrite);\n        }\n      } else {\n        textToWrite = concatenatedLinesWithoutColorByNewlineChar.get(eol);\n        if (!textToWrite) {\n          if (!linesWithoutColor) {\n            linesWithoutColor = [];\n            for (const line of lines) {\n              linesWithoutColor.push(AnsiEscape.removeCodes(line));\n            }\n          }\n\n          textToWrite = linesWithoutColor.join(eol);\n          concatenatedLinesWithoutColorByNewlineChar.set(eol, textToWrite);\n        }\n      }\n\n      provider.write(textToWrite, severity);\n    }\n  }\n\n  private _normalizeWriteParameters(parameters: TerminalWriteParameters): {\n    parts: string[];\n    options: ITerminalWriteOptions;\n  } {\n    if (parameters.length === 0) {\n      return { parts: [], options: {} };\n    } else {\n      const lastParameter: string | ITerminalWriteOptions = parameters[parameters.length - 1];\n      if (typeof lastParameter === 'string') {\n        return { parts: parameters as string[], options: {} };\n      } else {\n        return { parts: parameters.slice(0, -1) as string[], options: lastParameter };\n      }\n    }\n  }\n}\n"]}